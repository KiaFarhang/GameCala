"use strict";function deleteElement(e){e.parentElement.removeChild(e)}function ajax(e,t){var n=new XMLHttpRequest;return n.open(e,t,!0),n}function isScreenSmallerThan(e){var t=window.matchMedia("screen and (min-width: "+e+"px)");return!t.matches}function addEventListeners(){if(phone&&(document.addEventListener("touchstart",handleTouchStart,!!supportsPassive&&{passive:!0}),document.addEventListener("touchend",handleTouchMove,!!supportsPassive&&{passive:!0})),document.forms[0].addEventListener("submit",handleTimeInput),searchBox.addEventListener("keyup",handleSearchInput),document.getElementsByClassName("goToCompare")[0].addEventListener("click",handleGoToCompare),phone)for(var e=document.getElementsByTagName("header")[0].getElementsByTagName("div"),t=function(t){e[t].addEventListener("click",function(){transitionToSection(t+1)})},n=0;n<e.length;n++)t(n);document.getElementsByClassName("clearComparePane")[0].addEventListener("click",clearComparePane),document.getElementsByClassName("clearComparePane")[0].addEventListener("click",deselectWholeSearchList),document.getElementsByClassName("clearComparePane")[0].addEventListener("click",clearGlobalGameArray)}function Game(e){for(var t in e)null!=e[t]&&(this[t]=e[t])}function handleGoToCompare(){1==isCompareListEmpty()?document.getElementsByClassName("compareError")[0].textContent="Select games to compare":(document.getElementsByClassName("compareError")[0].textContent="",makeTabVisible(3),transitionToSection(3),phone||(document.getElementsByClassName("goToCompare")[0].classList.remove("visibile"),document.getElementsByClassName("goToCompare")[0].classList.add("hidden")))}function handleTimeInput(e){e.preventDefault();var t=document.getElementsByClassName("timeBox")[0].value;return isNaN(t)||t>24?void throwTimePlayedError():(document.forms[0].classList.remove("error"),timePlayedPerDay=t,localStorage.setItem("dailyTime",t),void(0==isSectionAccessibleYet(2)?(makeTabVisible(2),transitionToSection(2),document.getElementsByClassName("searchBox")[0].focus()):!function(){var e=document.getElementsByClassName("one")[0].getElementsByClassName("info")[0];e.textContent="Time updated",setTimeout(function(){e.textContent=""},1500),clearComparePane();for(var t=0;t<currentGameResults.length;t++)appendGameToCompareList(currentGameResults[t])}()))}function throwTimePlayedError(){var e=document.forms[0];e.classList.add("error"),e.getElementsByClassName("timeBox")[0].value=""}function handleSearchInput(){if(1!=searchBox.value.length){wipeSearchResults(),searchBox.removeEventListener("keyup",handleSearchInput);var e=queryOnTitle(searchBox.value);e.then(parseQueryResults,console.error).then(displayGamesInSearch,console.error),setTimeout(function(){searchBox.addEventListener("keyup",handleSearchInput)},200)}}function queryOnTitle(e){return new Promise(function(t,n){var a=ajax("GET","/query");a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("QUERY",""+e),a.addEventListener("load",function(){return 0==JSON.parse(a.responseText).length?(displaySearchError(),n()):t(JSON.parse(a.responseText))}),a.send()})}function parseQueryResults(e){return new Promise(function(t,n){var a=[];if(e.length>10)for(var r=0;r<10;r++){var s=new Game(e[r]);a.push(s)}else for(var i=0;i<e.length;i++){var o=new Game(e[i]);a.push(o)}return t(a)})}function displayGamesInSearch(e){for(var t=document.getElementsByClassName("resultsList")[0],n=0;n<e.length;n++){var a=e[n].Title,r=document.createElement("li");r.textContent=a,isAlreadyInResults(a)&&r.classList.add("added");var s=constructGameEventListener(e[n]);r.addEventListener("click",s),t.appendChild(r)}}function isAlreadyInResults(e){var t=document.getElementsByClassName("resultsTitle");if(0==t.length)return!1;for(var n=0;n<t.length;n++)if(e==t[n].textContent)return!0;return!1}function constructGameEventListener(e){var t=function(){event.target.classList.toggle("added");var t=e.Title;if(0==isAlreadyInResults(t))appendGameToCompareList(e);else{var n=grabGameByTitle(t,"results");deleteElement(n)}};return t}function wipeSearchResults(){for(var e=document.getElementsByClassName("resultsList")[0];e.firstChild;)e.removeChild(e.firstChild)}function displaySearchError(){var e=document.getElementsByClassName("resultsList")[0],t=document.createElement("li");t.classList.add("error"),t.textContent="No search results found.",e.appendChild(t)}function appendGameToCompareList(e){0==isAlreadyInGlobalArray(e)&&currentGameResults.push(e);var t=document.createElement("div");t.classList.add("compareGame");var n=document.createElement("div");n.classList.add("deleteButton"),n.innerText="X",n.addEventListener("click",deleteGameFromCompareList),t.appendChild(n);var a=e.Title,r=document.createElement("p");r.innerText=a,r.classList.add("resultsTitle"),t.appendChild(r);var s=createArrayOfInfoStrings(e);if(appendArrayContentsToElement(s,t),1==t.getElementsByTagName("p").length){var i=document.createElement("p");i.textContent="No info in database",t.appendChild(i)}document.getElementsByClassName("compare")[0].appendChild(t)}function createArrayOfInfoStrings(e){var t=[];for(var n in e)if("Title"!=n&&"Combined"!=n){var a=constructString(n,e[n]),r=document.createElement("p");r.textContent=a,t.push(r)}return t}function appendArrayContentsToElement(e,t){for(var n=0;n<e.length;n++)t.appendChild(e[n])}function constructString(e,t){var n=Math.round(t/timePlayedPerDay),a=parseDateIntoString(addDaysToDate(n));return 0==n?e+": Finish today":1==n?e+": "+n+" day ("+a+")":e+": "+n+" days ("+a+")"}function addDaysToDate(e){var t=new Date;return t.setDate(t.getDate()+e),t}function parseDateIntoString(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],n=t[e.getMonth()],a=e.getDate(),r=e.getFullYear();return n+" "+a+", "+r}function visibilityToggle(e){var t=document.getElementsByTagName("section")[e-1];if(phone){var n=getCurrentVisibleSection();changeVisibility(n)}changeVisibility(t)}function changeVisibility(e){e.classList.toggle("hidden"),e.classList.toggle("visible")}function getCurrentVisibleSection(){for(var e=document.getElementsByTagName("section"),t=0;t<e.length;t++)if(e[t].classList.contains("visible"))return e[t]}function transitionToSection(e){visibilityToggle(e),setCurrentHeader(e-1)}function setCurrentHeader(e){document.getElementsByTagName("header")[0].getElementsByClassName("current")[0].classList.remove("current"),document.getElementsByTagName("header")[0].getElementsByTagName("div")[e].classList.add("current")}function makeTabVisible(e){var t=document.getElementsByTagName("header")[0].getElementsByTagName("div");t[e-1].classList.contains("hidden")&&changeVisibility(t[e-1])}function clearComparePane(){for(var e=document.getElementsByClassName("compare")[0];e.firstChild;)e.removeChild(e.firstChild)}function deselectWholeSearchList(){for(var e=document.getElementsByClassName("resultsList")[0].getElementsByTagName("li"),t=0;t<e.length;t++)e[t].classList.contains("added")&&e[t].classList.remove("added")}function deleteGameFromCompareList(e){var t=e.target.parentElement,n=t.getElementsByClassName("resultsTitle")[0].textContent,a=grabGameByTitle(n,"search");null!=a&&a.classList.remove("added"),t.classList.add("deleted"),setTimeout(function(){deleteElement(t)},500),deleteGameFromCurrentArray(n)}function isCompareListEmpty(){return 0==document.getElementsByClassName("compareGame").length}function grabGameByTitle(e,t){if("results"==t){for(var n=document.getElementsByClassName("resultsTitle"),a=0;a<n.length;a++)if(e==n[a].textContent)return n[a].parentElement}else if("search"==t){for(var r=document.getElementsByClassName("resultsList")[0].getElementsByTagName("li"),s=0;s<r.length;s++)if(e==r[s].textContent)return r[s];return null}}function deleteGameFromCurrentArray(e){for(var t=0;t<currentGameResults.length;t++)currentGameResults[t].Title==e&&currentGameResults.splice(t,1)}function clearGlobalGameArray(){currentGameResults=[]}function isAlreadyInGlobalArray(e){for(var t=0;t<currentGameResults.length;t++)if(e==currentGameResults[t])return!0;return!1}function handleTouchStart(e){xStart=e.touches[0].clientX,yStart=e.touches[0].clientY}function handleTouchMove(e){if(xStart&&yStart){var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,a=t-xStart,r=n-yStart;if(!(Math.abs(r)>100||Math.abs(a)<40)){var s=getCurrentHeaderTab();if(a<0){var i=s+2;i<4&&1==isSectionAccessibleYet(i)&&(transitionToSection(i),makeTabVisible(i))}else{var o=s-1;o>-1&&transitionToSection(o+1)}t=null,n=null}}}function isSectionAccessibleYet(e){var t=document.getElementsByTagName("header")[0].getElementsByTagName("div");return!t[e-1].classList.contains("hidden")}function getCurrentHeaderTab(){for(var e=document.getElementsByTagName("header")[0].getElementsByTagName("div"),t=0;t<e.length;t++)if(e[t].classList.contains("current"))return t}function setDailyTimeFromStorageIfExists(){null!=localStorage.getItem("dailyTime")&&(document.getElementsByClassName("timeBox")[0].value=localStorage.getItem("dailyTime"))}var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("test",null,opts)}catch(e){}var currentGameResults=[],phone=isScreenSmallerThan(768);!function(e,t,n,a,r,s,i){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,s=t.createElement(n),i=t.getElementsByTagName(n)[0],s.async=1,s.src=a,i.parentNode.insertBefore(s,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-89606633-2","auto"),ga("send","pageview");var timePlayedPerDay=null,xStart=null,yStart=null,searchBox=document.getElementsByClassName("searchBox")[0];addEventListeners(),setDailyTimeFromStorageIfExists(),document.getElementsByClassName("timeBox")[0].focus();