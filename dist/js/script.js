"use strict";function deleteElement(e){e.parentElement.removeChild(e)}function ajax(e,t){var n=new XMLHttpRequest;return n.open(e,t,!0),n}function addEventListeners(){document.forms[0].addEventListener("submit",handleTimeInput),searchBox.addEventListener("keyup",handleSearchInput),document.getElementsByClassName("goToCompare")[0].addEventListener("click",handleGoToCompare);for(var e=document.getElementsByTagName("header")[0].getElementsByTagName("div"),t=function(t){e[t].addEventListener("click",function(){transitionToSection(t+1)})},n=0;n<e.length;n++)t(n);document.getElementsByClassName("clearComparePane")[0].addEventListener("click",clearComparePane)}function Game(e){for(var t in e)null!=e[t]&&(this[t]=e[t])}function handleGoToCompare(){makeTabVisible(3),transitionToSection(3)}function handleTimeInput(e){e.preventDefault();var t=parseInt(document.getElementsByClassName("timeBox")[0].value);isNaN(t)?throwTimePlayedError():(document.forms[0].classList.remove("error"),timePlayedPerWeek=t,makeTabVisible(2),transitionToSection(2),document.getElementsByClassName("searchBox")[0].focus())}function throwTimePlayedError(){var e=document.forms[0];e.classList.add("error"),e.getElementsByClassName("timeBox")[0].value=""}function handleSearchInput(){if(1!=searchBox.value.length){wipeSearchResults(),searchBox.removeEventListener("keyup",handleSearchInput);var e=queryOnTitle(searchBox.value);e.then(parseQueryResults,console.error).then(displayGamesInSearch,console.error),setTimeout(function(){searchBox.addEventListener("keyup",handleSearchInput)},200)}}function queryOnTitle(e){return new Promise(function(t,n){var a=ajax("GET","/query");a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("QUERY",""+e),a.addEventListener("load",function(){return 0==JSON.parse(a.responseText).length?(displaySearchError(),n()):t(JSON.parse(a.responseText))}),a.send()})}function parseQueryResults(e){return new Promise(function(t,n){var a=[];if(e.length>10)for(var r=0;r<10;r++){var s=new Game(e[r]);a.push(s)}else for(var i=0;i<e.length;i++){var o=new Game(e[i]);a.push(o)}return t(a)})}function displayGamesInSearch(e){for(var t=document.getElementsByClassName("resultsList")[0],n=0;n<e.length;n++){var a=e[n].Title,r=document.createElement("li");r.innerText=a;var s=constructGameEventListener(e[n]);r.addEventListener("click",s),t.appendChild(r)}}function isAlreadyInResults(e){var t=document.getElementsByClassName("resultsTitle");if(0==t.length)return!1;for(var n=0;n<t.length;n++)if(e==t[n].textContent)return!0;return!1}function showGameAsAdded(e){1!=e.classList.contains("added")&&e.classList.add("added")}function constructGameEventListener(e){var t=function(){var t=e.Title;0==isAlreadyInResults(t)&&(showGameAsAdded(event.target),appendGameToCompareList(e))};return t}function wipeSearchResults(){for(var e=document.getElementsByClassName("resultsList")[0];e.firstChild;)e.removeChild(e.firstChild)}function displaySearchError(){var e=document.getElementsByClassName("resultsList")[0],t=document.createElement("li");t.classList.add("error"),t.innerText="No search results found.",e.appendChild(t)}function appendGameToCompareList(e){var t=document.createElement("div");t.classList.add("compareGame");var n=document.createElement("div");n.classList.add("deleteButton"),n.innerText="X",n.addEventListener("click",deleteGameFromCompareList),t.appendChild(n);var a=e.Title,r=document.createElement("p");r.innerText=a,r.classList.add("resultsTitle"),t.appendChild(r);for(var s in e)if("Title"!=s&&"Combined"!=s){var i=constructString(s,e[s]),o=document.createElement("p");o.innerText=i,t.appendChild(o)}document.getElementsByClassName("compare")[0].appendChild(t)}function constructString(e,t){var n=calculateWeeksNeeded(parseInt(t)),a=parseDateIntoString(addDaysToDate(7*n));return e+": "+n+" weeks ("+a+")"}function calculateWeeksNeeded(e){return Math.round(e/timePlayedPerWeek)}function addDaysToDate(e){var t=new Date;return t.setDate(t.getDate()+e),t}function parseDateIntoString(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],n=t[e.getMonth()],a=e.getDate(),r=e.getFullYear();return n+" "+a+", "+r}function visibilityToggle(e){var t=document.getElementsByTagName("section")[e-1],n=getCurrentVisibleSection();changeVisibility(n),changeVisibility(t)}function changeVisibility(e){e.classList.toggle("hidden"),e.classList.toggle("visible")}function getCurrentVisibleSection(){for(var e=document.getElementsByTagName("section"),t=0;t<e.length;t++)if(e[t].classList.contains("visible"))return e[t]}function transitionToSection(e){visibilityToggle(e)}function makeTabVisible(e){var t=document.getElementsByTagName("header")[0].getElementsByTagName("div");t[e-1].classList.contains("hidden")&&changeVisibility(t[e-1])}function clearComparePane(){for(var e=document.getElementsByClassName("compare")[0];e.firstChild;)e.removeChild(e.firstChild)}function deleteGameFromCompareList(e){var t=e.target.parentElement;t.classList.add("deleted"),setTimeout(function(){deleteElement(t)},500)}var timePlayedPerWeek=null,searchBox=document.getElementsByClassName("searchBox")[0];addEventListeners(),document.getElementsByClassName("timeBox")[0].focus();