"use strict";function Game(e){for(var t in e)null!=e[t]&&(this[t]=e[t])}function handleGoToCompare(){visibilityToggle(3)}function handleTimeInput(e){e.preventDefault();var t=document.getElementsByClassName("timeBox")[0];timePlayedPerWeek=parseInt(t.value),visibilityToggle(2)}function handleSearchInput(){if(1!=searchBox.value.length){wipeSearchResults(),searchBox.removeEventListener("keyup",handleSearchInput);var e=queryOnTitle(searchBox.value);e.then(parseQueryResults,console.error).then(displayGamesInSearch,console.error),setTimeout(function(){searchBox.addEventListener("keyup",handleSearchInput)},200)}}function queryOnTitle(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET","/query",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("QUERY",""+e),r.addEventListener("load",function(){return 0==JSON.parse(r.responseText).length?(displaySearchError(),n()):t(JSON.parse(r.responseText))}),r.send()})}function parseQueryResults(e){return new Promise(function(t,n){var r=[];if(e.length>10)for(var a=0;a<10;a++){var s=new Game(e[a]);r.push(s)}else for(var i=0;i<e.length;i++){var o=new Game(e[i]);r.push(o)}return t(r)})}function displayGamesInSearch(e){for(var t=document.getElementsByClassName("resultsList")[0],n=0;n<e.length;n++){var r=e[n].Title,a=document.createElement("li");a.innerText=r;var s=constructGameEventListener(e[n]);a.addEventListener("click",s),t.appendChild(a)}}function constructGameEventListener(e){var t=function(){appendGameToCompareList(e)};return t}function wipeSearchResults(){for(var e=document.getElementsByClassName("resultsList")[0];e.firstChild;)e.removeChild(e.firstChild)}function displaySearchError(){var e=document.getElementsByClassName("resultsList")[0],t=document.createElement("li");t.classList.add("error"),t.innerText="No search results found.",e.appendChild(t)}function appendGameToCompareList(e){var t=document.createElement("div");t.classList.add("compareGame");var n=e.Title,r=document.createElement("p");r.innerText=n,t.appendChild(r);for(var a in e)if("Title"!=a){var s=constructString(a,e[a]),i=document.createElement("p");i.innerText=s,t.appendChild(i)}document.getElementsByClassName("compare")[0].appendChild(t)}function constructString(e,t){var n=calculateWeeksNeeded(parseInt(t));return n+" weeks for "+e}function calculateWeeksNeeded(e){return e/timePlayedPerWeek}function visibilityToggle(e){var t=document.getElementsByTagName("section")[e-1],n=getCurrentVisibleSection();changeVisibility(n),changeVisibility(t)}function changeVisibility(e){e.classList.toggle("hidden"),e.classList.toggle("visible")}function getCurrentVisibleSection(){for(var e=document.getElementsByTagName("section"),t=0;t<e.length;t++)if(e[t].classList.contains("visible"))return e[t]}document.forms[0].addEventListener("submit",handleTimeInput);var searchBox=document.getElementsByClassName("searchBox")[0];searchBox.addEventListener("keyup",handleSearchInput),document.getElementsByClassName("goToCompare")[0].addEventListener("click",handleGoToCompare);var timePlayedPerWeek=null;